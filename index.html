<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIBM Placement Portal | KnowYourPlacement</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { -webkit-user-select: none; -moz-user-select: none; user-select: none; overflow: hidden; }
        .blurred { filter: blur(25px); pointer-events: none; }
        .sidebar-item.active { background-color: #2563eb; color: white; border-color: #2563eb; }
        #protected-ui { display: none; }
    </style>
</head>
<body class="bg-gray-50 font-sans" oncontextmenu="return false;">

    <div id="login-screen" class="min-h-screen flex items-center justify-center bg-slate-900 p-4">
        <div class="bg-white p-10 rounded-2xl shadow-2xl w-full max-w-md text-center">
            <div class="text-blue-600 font-bold text-3xl mb-2">KnowYourPlacement</div>
            <h1 class="text-xl font-semibold text-gray-800 mb-6">Verification Required</h1>
            <p class="text-gray-500 mb-8">Access is restricted to students with a valid <b>@pibm.in</b> email address.</p>
            <button id="btn-login" class="flex items-center justify-center gap-3 w-full bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-50 transition font-medium">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
                Sign in with Google
            </button>
        </div>
    </div>

    <div id="protected-ui" class="h-screen flex flex-col">
        <header class="bg-white border-b px-6 py-4 flex justify-between items-center">
            <div class="font-bold text-xl text-blue-600">Placement Drive 2026</div>
            <button id="btn-logout" class="text-red-600 text-sm font-semibold hover:underline">Logout</button>
        </header>

        <div class="flex flex-1 overflow-hidden">
            <nav class="w-1/3 md:w-1/4 bg-white border-r overflow-y-auto p-4 space-y-2" id="company-list">
                <p class="text-gray-400 text-xs font-bold uppercase p-2">Loading jobs...</p>
            </nav>

            <main class="flex-1 bg-white overflow-y-auto p-8 md:p-12" id="job-display">
                <div class="text-center text-gray-400 mt-20">
                    <p>Select a company from the left to view details.</p>
                </div>
            </main>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- PASTE YOUR CONFIG HERE ---
        const firebaseConfig = {
            apiKey: "AIzaSyD69PnIcAaNC-MVHAR9iaWwNvrxyMLfCys",
            authDomain: "know-your-placement.firebaseapp.com",
            projectId: "know-your-placement",
            storageBucket: "know-your-placement.firebasestorage.app",
            messagingSenderId: "603215423128",
            appId: "1:603215423128:web:96638dca43ae072b98d2ed"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        const loginScreen = document.getElementById('login-screen');
        const protectedUI = document.getElementById('protected-ui');
        const companyList = document.getElementById('company-list');
        const jobDisplay = document.getElementById('job-display');

        // Authentication logic
        document.getElementById('btn-login').onclick = () => signInWithPopup(auth, provider);
        document.getElementById('btn-logout').onclick = () => signOut(auth);

        onAuthStateChanged(auth, (user) => {
            if (user && user.email.endsWith('@pibm.in')) {
                loginScreen.classList.add('hidden');
                protectedUI.style.display = 'flex';
                userEmailSpan.innerText = user.email;
                loadJobs(); // Fetch from Firestore
            } else if (user) {
                alert("Access Denied: Use @pibm.in ID");
                signOut(auth);
            } else {
                loginScreen.classList.remove('hidden');
                protectedUI.style.display = 'none';
            }
        });

        // Firestore Logic: Load jobs in real-time
        function loadJobs() {
            onSnapshot(collection(db, "placements"), (snapshot) => {
                companyList.innerHTML = '<p class="text-gray-400 text-xs font-bold uppercase p-2">Available Jobs</p>';
                
                snapshot.forEach((doc) => {
                    const job = doc.data();
                    const jobId = doc.id;

                    const btn = document.createElement('div');
                    btn.className = "sidebar-item p-4 rounded-xl cursor-pointer transition border text-gray-600 hover:bg-gray-50 mb-2";
                    btn.innerHTML = `<p class="font-bold">${job.company}</p><p class="text-xs uppercase">${job.role}</p>`;
                    btn.onclick = () => {
                        // Update active state
                        document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
                        btn.classList.add('active');
                        // Show details
                        jobDisplay.innerHTML = `
                            <div class="animate-fade-in space-y-6">
                                <h2 class="text-3xl font-bold text-gray-900">${job.role}</h2>
                                <p class="text-blue-600 font-semibold text-lg">${job.company}</p>
                                <hr>
                                <div class="text-gray-700 leading-relaxed whitespace-pre-wrap">${job.details}</div>
                            </div>
                        `;
                    };
                    companyList.appendChild(btn);
                });
            });
        }

        // Security Deterrents
        window.onblur = () => document.body.classList.add('blurred');
        window.onfocus = () => document.body.classList.remove('blurred');
        document.addEventListener('keydown', e => {
            if (e.ctrlKey && (e.key === 'p' || e.key === 's' || e.key === 'u')) {
                e.preventDefault();
                alert("Restricted.");
            }
        });
    </script>
</body>
</html>




